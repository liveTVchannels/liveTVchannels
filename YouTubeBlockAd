#!name=YouTube Ultimate (Best of Both Worlds)
#!desc=K·∫øt h·ª£p s·ª± ƒë∆°n gi·∫£n c·ªßa Gemini v·ªõi t√≠nh nƒÉng n√¢ng cao th·ª±c s·ª± c·∫ßn thi·∫øt. Ch·∫∑n ads hi·ªáu qu·∫£, ·ªïn ƒë·ªãnh cao, hi·ªáu su·∫•t t·ªëi ∆∞u.
#!author=AI Expert (H·ªçc h·ªèi t·ª´ dhungx & Gemini)
# update: 06/06/2025
# Philosophy: "Simple yet Powerful" - 80/20 rule applied

#!icon=https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png

[Rule]
# [CORE] √âp YouTube s·ª≠ d·ª•ng TCP ƒë·ªÉ script c√≥ th·ªÉ x·ª≠ l√Ω - Quan tr·ªçng nh·∫•t!
AND,((DOMAIN-SUFFIX,googlevideo.com), (PROTOCOL,UDP)),REJECT

# [ESSENTIAL] Ch·∫∑n c√°c domain ads ch√≠nh - Ch·ªâ nh·ªØng c√°i th·ª±c s·ª± c·∫ßn thi·∫øt
DOMAIN-SUFFIX,doubleclick.net,REJECT
DOMAIN-SUFFIX,googleadservices.com,REJECT
DOMAIN-SUFFIX,googletagservices.com,REJECT
DOMAIN-SUFFIX,googlesyndication.com,REJECT
DOMAIN,ads.youtube.com,REJECT

# [PERFORMANCE] Ch·∫∑n mid-roll ads domain - T√≠nh nƒÉng n√¢ng cao nh∆∞ng c·∫ßn thi·∫øt
DOMAIN-SUFFIX,googleadsserving.cn,REJECT-TINYGIF

[URL Rewrite]
# [SMART] G·ªôp c√°c rules th√¥ng minh nh∆∞ Gemini nh∆∞ng b·ªï sung mid-roll
^https?://(www|s|m)\.youtube\.com/(api/stats/ads|pagead|ptracking|get_midroll_info) - reject-200

# [ESSENTIAL] Ch·∫∑n QoE tracking - ·∫¢nh h∆∞·ªüng ƒë·∫øn ads loading
^https?://(www|s|m)\.youtube\.com/api/stats/qoe\?adcontext - reject-200

# [ADVANCED] Ch·∫∑n player ads - T√≠nh nƒÉng n√¢ng cao th·ª±c s·ª± h·ªØu √≠ch
^https?://(www|s|m)\.youtube\.com/youtubei/v1/player/ad - reject-200

# [PERFORMANCE] Ch·∫∑n analytics ch√≠nh - Gi·∫£m t·∫£i network
^https?://(www|s|m)\.youtube\.com/api/stats/(atr|watchtime) - reject-200

# [SMART] Video ads pattern - H·ªçc t·ª´ Enhanced nh∆∞ng t·ªëi ∆∞u h√≥a
(^https?://[\w-]+\.googlevideo\.com/(?!dclk_video_ads).+?)&ctier=L(&.+?),ctier,(.+) $1$2$3 302

[Script]
# [MASTER] Script ch√≠nh - H·ªçc t·ª´ Gemini v·ªõi c·∫£i ti·∫øn t·ª´ Enhanced
# Timeout tƒÉng l√™n 45s ƒë·ªÉ x·ª≠ l√Ω response l·ªõn ·ªïn ƒë·ªãnh h∆°n
youtube.response = type=http-response,pattern=^https://youtubei\.googleapis\.com/youtubei/v1/(browse|next|player|search|reel/reel_watch_sequence|guide|account/get_setting|get_watch),requires-body=1,max-size=-1,binary-body-mode=1,timeout=45,engine=jsc,script-path=https://raw.githubusercontent.com/dhungx/modules-shadowrocket/main/js/Yt/youtube.response.ultimate.js,argument="{\"lyricLang\":\"{{{ng√¥n ng·ªØ d·ªãch l·ªùi b√†i h√°t|auto}}}\",\"captionLang\":\"{{{ng√¥n ng·ªØ d·ªãch ph·ª• ƒë·ªÅ|auto}}}\",\"blockUpload\":{{{ch·∫∑n n√∫t t·∫£i l√™n|false}}},\"blockImmersive\":{{{ch·∫∑n n√∫t ch·ªçn ƒëo·∫°n|false}}},\"blockShorts\":{{{ch·∫∑n YouTube Shorts|false}}},\"enhancedBlocking\":{{{ch·∫∑n ads n√¢ng cao|true}}},\"debug\":{{{ch·∫ø ƒë·ªô debug|false}}}}"

# [OPTIONAL] Script b·ªï tr·ª£ cho request - Ch·ªâ k√≠ch ho·∫°t khi c·∫ßn
# Uncomment d√≤ng d∆∞·ªõi n·∫øu g·∫∑p ads leak (ads v·∫´n hi·ªán)
# youtube.request = type=http-request,pattern=^https://youtubei\.googleapis\.com/youtubei/v1/(browse|next|search),requires-body=1,max-size=-1,binary-body-mode=1,timeout=30,engine=jsc,script-path=https://raw.githubusercontent.com/dhungx/modules-shadowrocket/main/js/Yt/youtube.request.lite.js

[MITM]
# [REQUIRED] Hostname c·∫ßn thi·∫øt - H·ªçc t·ª´ Gemini v·ªõi b·ªï sung t·ª´ Enhanced
hostname = %APPEND% *.googlevideo.com, m.youtube.com, s.youtube.com, www.youtube.com, youtubei.googleapis.com, *.doubleclick.net, *.googleadservices.com

# [ADVANCED] Network optimization - T·ª´ Enhanced nh∆∞ng ƒë∆∞·ª£c t·ªëi ∆∞u
[General]
# Skip local traffic ƒë·ªÉ tƒÉng t·ªëc
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local

# Bypass cho c√°c IP private - Gi·∫£m overhead
bypass-tun = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.18.0.0/15, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32

# DNS servers t·ªëi ∆∞u - Cloudflare + Google
dns-server = 1.1.1.1, 1.0.0.1, 8.8.8.8, 8.8.4.4

# ==================================================
# üìã H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG V√Ä T√ôY CH·ªàNH
# ==================================================

# üéØ M·ª§C TI√äU:
# - Ch·∫∑n 99% qu·∫£ng c√°o YouTube v·ªõi hi·ªáu su·∫•t cao nh·∫•t
# - ·ªîn ƒë·ªãnh, √≠t l·ªói, d·ªÖ maintain
# - H·ªó tr·ª£ PiP, background play, lyrics, captions

# ‚ö° HI·ªÜU SU·∫§T:
# - Ch·ªâ 1 script ch√≠nh (c√≥ th·ªÉ th√™m request script n·∫øu c·∫ßn)
# - Rules ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a, g·ªôp th√¥ng minh
# - Timeout h·ª£p l√Ω: 45s cho response, 30s cho request

# üîß T√ôY CH·ªàNH:
# 1. Mu·ªën ch·∫∑n Shorts: ƒê·ªïi blockShorts th√†nh true
# 2. G·∫∑p ads leak: B·ªè comment d√≤ng youtube.request
# 3. Mu·ªën debug: ƒê·ªïi debug th√†nh true
# 4. Ch·∫∑n upload button: ƒê·ªïi blockUpload th√†nh true

# üìä MONITORING:
# - Ki·ªÉm tra log ƒë·ªÉ th·∫•y ads b·ªã ch·∫∑n
# - N·∫øu YouTube load ch·∫≠m: Gi·∫£m timeout xu·ªëng 30s
# - N·∫øu v·∫´n c√≥ ads: K√≠ch ho·∫°t youtube.request script

# üé® ADVANCED FEATURES:
# - enhancedBlocking: Ch·∫∑n mid-roll, overlay ads
# - Auto language detection cho lyrics v√† captions
# - Smart video ads pattern matching

# üí° TIP:
# Module n√†y √°p d·ª•ng nguy√™n t·∫Øc 80/20:
# - 20% rules ch·∫∑n 80% ads (core blocking)
# - 80% t√≠nh nƒÉng n√¢ng cao ch·ªâ khi th·ª±c s·ª± c·∫ßn
